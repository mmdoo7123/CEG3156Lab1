LIBRARY ieee;
USE ieee.std_logic_1164.ALL;

ENTITY expOverUnderUnit IS
PORT(
    -- Operand nonzero flags
    i_A_nonzero   : IN  STD_LOGIC;
    i_B_nonzero   : IN  STD_LOGIC;

    -- Final exponent
    i_exp_final   : IN  STD_LOGIC_VECTOR(6 DOWNTO 0);

    -- Optional carry from exponent arithmetic
    i_exp_carry   : IN  STD_LOGIC;

    -- Outputs
    o_underflow   : OUT STD_LOGIC;
    o_overflow    : OUT STD_LOGIC;
    o_overunder   : OUT STD_LOGIC
);
END expOverUnderUnit;

ARCHITECTURE structural OF expOverUnderUnit IS

------------------------------------------------------------------
-- Constants
------------------------------------------------------------------
CONSTANT EXP_ZERO : STD_LOGIC_VECTOR(6 DOWNTO 0) := "0000000";
CONSTANT EXP_ONES : STD_LOGIC_VECTOR(6 DOWNTO 0) := "1111111";

------------------------------------------------------------------
-- Comparator Component (YOUR DESIGN)
------------------------------------------------------------------
COMPONENT genericComparator
GENERIC ( n : INTEGER := 7 );
PORT(
    i_Ai, i_Bi : IN  STD_LOGIC_VECTOR(n-1 DOWNTO 0);
    o_GT, o_LT, o_EQ : OUT STD_LOGIC
);
END COMPONENT;

------------------------------------------------------------------
-- Signals
------------------------------------------------------------------
SIGNAL zero_EQ  : STD_LOGIC;
SIGNAL ones_EQ  : STD_LOGIC;

SIGNAL zero_GT, zero_LT : STD_LOGIC;
SIGNAL ones_GT, ones_LT : STD_LOGIC;

SIGNAL operands_nonzero : STD_LOGIC;

BEGIN

------------------------------------------------------------------
-- Operand Nonzero Check
------------------------------------------------------------------
operands_nonzero <= i_A_nonzero AND i_B_nonzero;

------------------------------------------------------------------
-- Compare exponent to ZERO
------------------------------------------------------------------
COMP_ZERO : genericComparator
GENERIC MAP ( n => 7 )
PORT MAP(
    i_Ai => i_exp_final,
    i_Bi => EXP_ZERO,
    o_GT => zero_GT,
    o_LT => zero_LT,
    o_EQ => zero_EQ
);

------------------------------------------------------------------
-- Compare exponent to ALL ONES
------------------------------------------------------------------
COMP_ONES : genericComparator
GENERIC MAP ( n => 7 )
PORT MAP(
    i_Ai => i_exp_final,
    i_Bi => EXP_ONES,
    o_GT => ones_GT,
    o_LT => ones_LT,
    o_EQ => ones_EQ
);

------------------------------------------------------------------
-- Underflow Logic
-- If operands nonzero AND exponent == 0
------------------------------------------------------------------
o_underflow <= operands_nonzero AND zero_EQ;

------------------------------------------------------------------
-- Overflow Logic
-- If exponent == all ones OR carry says overflow
------------------------------------------------------------------
o_overflow <= ones_EQ OR i_exp_carry;

------------------------------------------------------------------
-- Combined Flag
------------------------------------------------------------------
o_overunder <= o_underflow OR o_overflow;

END structural;
